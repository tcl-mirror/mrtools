
<!DOCTYPE html><html><head>
<title>micca-Embedded - Micca Embedded Macros</title>
<style type="text/css"><!--
    HTML {
	background: 	#FFFFFF;
	color: 		black;
    }
    BODY {
	background: 	#FFFFFF;
	color:	 	black;
    }
    DIV.doctools {
	margin-left:	10%;
	margin-right:	10%;
    }
    DIV.doctools H1,DIV.doctools H2 {
	margin-left:	-5%;
    }
    H1, H2, H3, H4 {
	margin-top: 	1em;
	font-family:	sans-serif;
	font-size:	large;
	color:		#005A9C;
	background: 	transparent;
	text-align:		left;
    }
    H1.doctools_title {
	text-align: center;
    }
    UL,OL {
	margin-right: 0em;
	margin-top: 3pt;
	margin-bottom: 3pt;
    }
    UL LI {
	list-style: disc;
    }
    OL LI {
	list-style: decimal;
    }
    DT {
	padding-top: 	1ex;
    }
    UL.doctools_toc,UL.doctools_toc UL, UL.doctools_toc UL UL {
	font:		normal 12pt/14pt sans-serif;
	list-style:	none;
    }
    LI.doctools_section, LI.doctools_subsection {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding: 	0em;
    }
    PRE {
	display: 	block;
	font-family:	monospace;
	white-space:	pre;
	margin:		0%;
	padding-top:	0.5ex;
	padding-bottom:	0.5ex;
	padding-left:	1ex;
	padding-right:	1ex;
	width:		100%;
    }
    PRE.doctools_example {
	color: 		black;
	background: 	#f5dcb3;
	border:		1px solid black;
    }
    UL.doctools_requirements LI, UL.doctools_syntax LI {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding:	0em;
    }
    DIV.doctools_synopsis {
	color: 		black;
	background: 	#80ffff;
	border:		1px solid black;
	font-family:	serif;
	margin-top: 	1em;
	margin-bottom: 	1em;
    }
    UL.doctools_syntax {
	margin-top: 	1em;
	border-top:	1px solid black;
    }
    UL.doctools_requirements {
	margin-bottom: 	1em;
	border-bottom:	1px solid black;
    }
--></style>
</head>
<!-- Generated from file 'embedded.man' by tcllib/doctools with format 'html'
   -->
<!-- Copyright &amp;copy; 2015 - 2019 by G. Andrew Mangogna
   -->
<!-- micca-Embedded.n
   -->
<body><hr> [
   <a href="../toc.html">Table Of Contents</a>
| <a href="../index.html">Keyword Index</a>
 ] <hr>
<div class="doctools">
<h1 class="doctools_title">micca-Embedded(n) 1.1.8 micca &quot;Micca Embedded Macros&quot;</h1>
<div id="name" class="doctools_section"><h2><a name="name">Name</a></h2>
<p>micca-Embedded - Commands for Code Generation</p>
</div>
<div id="toc" class="doctools_section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="doctools_toc">
<li class="doctools_section"><a href="#toc">Table Of Contents</a></li>
<li class="doctools_section"><a href="#synopsis">Synopsis</a></li>
<li class="doctools_section"><a href="#section1">Description</a></li>
<li class="doctools_section"><a href="#section2">Commands</a></li>
<li class="doctools_section"><a href="#section3">Class Operations</a></li>
<li class="doctools_section"><a href="#section4">Relationship Operations</a>
<ul>
<li class="doctools_subsection"><a href="#subsection1">Association Operations</a></li>
<li class="doctools_subsection"><a href="#subsection2">Simple Association Operations</a></li>
<li class="doctools_subsection"><a href="#subsection3">Class Based Association Operations</a></li>
<li class="doctools_subsection"><a href="#subsection4">Single Assigner Association Operations</a></li>
<li class="doctools_subsection"><a href="#subsection5">Multiple Assigner Association Operations</a></li>
<li class="doctools_subsection"><a href="#subsection6">Generalization Operations</a></li>
</ul>
</li>
<li class="doctools_section"><a href="#section5">Instance Operations</a></li>
<li class="doctools_section"><a href="#section6">Instance Set Operations</a></li>
<li class="doctools_section"><a href="#section7">External Entity Operations</a></li>
<li class="doctools_section"><a href="#see-also">See Also</a></li>
<li class="doctools_section"><a href="#keywords">Keywords</a></li>
<li class="doctools_section"><a href="#copyright">Copyright</a></li>
</ul>
</div>
<div id="synopsis" class="doctools_section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="doctools_synopsis">
<ul class="doctools_syntax">
<li><a href="#1">&lt;%<i class="arg">class</i> <b class="cmd">create</b> <i class="arg">instref</i> <i class="arg"><span class="opt">?attr1 value1 attr2 value2 ...?</span></i></a></li>
<li><a href="#2">&lt;%<i class="arg">class</i> <b class="cmd">createasync</b> <i class="arg">event</i> {<i class="arg"><span class="opt">?param1 value1 param2 value2 ...?</span></i>} <i class="arg"><span class="opt">?attr1 value1 attr2 value2 ...?</span></i></a></li>
<li><a href="#3">&lt;%<i class="arg">class</i> <b class="cmd">createin</b> <i class="arg">instref</i> <i class="arg">state</i> <i class="arg"><span class="opt">?attr1 value1 attr2 value2 ...?</span></i></a></li>
<li><a href="#4">&lt;%<i class="arg">class</i> <b class="cmd">findByName</b> <i class="arg">instname</i> <i class="arg">instref</i>%&gt;</a></li>
<li><a href="#5">&lt;%<i class="arg">class</i> <b class="cmd">findWhere</b> <i class="arg">instref</i> <i class="arg">clause</i>%&gt;</a></li>
<li><a href="#6">&lt;%<i class="arg">class</i> <b class="cmd">foreachInstance</b> <i class="arg">instref</i>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></li>
<li><a href="#7">&lt;%<i class="arg">class</i> <b class="cmd">foreachWhere</b> <i class="arg">instref</i> <i class="arg">clause</i>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></li>
<li><a href="#8">&lt;%<i class="arg">class</i> <b class="cmd">idtoref</b> <i class="arg">instid</i> <i class="arg">instref</i>%&gt;</a></li>
<li><a href="#9">&lt;%<i class="arg">class</i> <b class="cmd">instset</b> <i class="arg">setvarname</i>%&gt;</a></li>
<li><a href="#10">&lt;%<i class="arg">class</i> <b class="cmd">operation</b> <i class="arg">opname</i> <i class="arg"><span class="opt">?name1 value1 ...?</span></i>%&gt;</a></li>
<li><a href="#11">&lt;%<i class="arg">class</i> <b class="cmd">refvar</b> <i class="arg">refvarname</i>%&gt;</a></li>
<li><a href="#12">&lt;%<i class="arg">class</i> <b class="cmd">selectWhere</b> <i class="arg">instref</i> <i class="arg">clause</i> <i class="arg">instset</i>%&gt;</a></li>
<li><a href="#13">&lt;%<i class="arg">association</i> <b class="cmd">reference</b> <i class="arg">sourceref</i> <i class="arg">targetref</i>%&gt;</a></li>
<li><a href="#14">&lt;%<i class="arg">association</i> <b class="cmd">reference</b> <i class="arg">assocref</i> <i class="arg">partref</i> <i class="arg"><span class="opt">?direction?</span></i>%&gt;</a></li>
<li><a href="#15">&lt;%<i class="arg">association</i> <b class="cmd">signal</b> <i class="arg">event</i> <i class="arg"><span class="opt">?name1 value1 name2 value2 ...?</span></i>%&gt;</a></li>
<li><a href="#16">&lt;%<i class="arg">association</i> <b class="cmd">create</b> <i class="arg">instref</i> <i class="arg">idinst</i>%&gt;</a></li>
<li><a href="#17">&lt;%<i class="arg">association</i> <b class="cmd">findByIdInstance</b> <i class="arg">idinst</i> <i class="arg">instref</i>%&gt;</a></li>
<li><a href="#18">&lt;%<i class="arg">generalization</i> <b class="cmd">classify</b> <i class="arg">superref</i> <i class="arg">subref</i>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></li>
<li><a href="#19">&lt;%<b class="cmd">subclass</b> <i class="arg">classname</i>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></li>
<li><a href="#20">&lt;%<b class="cmd">default</b>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></li>
<li><a href="#21">&lt;%<i class="arg">generalization</i> <b class="cmd">reclassify</b> <i class="arg">subref</i> <i class="arg">newsubclass</i> <i class="arg">newsubref</i> <i class="arg"><span class="opt">?attr1 value1 ...?</span></i>%&gt;</a></li>
<li><a href="#22">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">assign</b> <i class="arg"><span class="opt">?assignspec1 assignspec2 ...?</span></i>%&gt;</a></li>
<li><a href="#23">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">attr</b> <i class="arg">name</i>%&gt;</a></li>
<li><a href="#24">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">canceldelayed</b> <i class="arg">event</i> <i class="arg"><span class="opt">?sourceinst?</span></i>%&gt;</a></li>
<li><a href="#25">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">delayremaining</b> <i class="arg">event</i> <i class="arg"><span class="opt">?sourceinst?</span></i>%&gt;</a></li>
<li><a href="#26">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">delaysignal</b> <i class="arg">time</i> <i class="arg">event</i> <i class="arg"><span class="opt">?name1 value1 name2 value2 ...?</span></i>%&gt;</a></li>
<li><a href="#27">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">delete</b>%&gt;</a></li>
<li><a href="#28">&lt;%<b class="cmd">instance</b> <i class="arg">startref</i> <b class="cmd">findOneRelated</b>&gt; <i class="arg">instref</i> <i class="arg">rel1</i> <i class="arg"><span class="opt">?rel2 ...?</span></i>%&gt;</a></li>
<li><a href="#29">&lt;%<b class="cmd">instance</b> <i class="arg">startref</i> <b class="cmd">findRelatedWhere</b> <i class="arg">instref</i> <i class="arg">boolexpr</i> <i class="arg">rel1</i> <i class="arg"><span class="opt">?rel2 ...?</span></i>%&gt;</a></li>
<li><a href="#30">&lt;%<b class="cmd">instance</b> <i class="arg">startref</i> <b class="cmd">foreachRelated</b> <i class="arg">instref</i> <i class="arg">rel1</i> <i class="arg"><span class="opt">?rel2 ...?</span></i>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></li>
<li><a href="#31">&lt;%<b class="cmd">instance</b> <i class="arg">startref</i> <b class="cmd">foreachRelatedWhere</b> <i class="arg">instref</i> <i class="arg">boolexpr</i> <i class="arg">rel1</i> <i class="arg"><span class="opt">?rel2 ...?</span></i>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></li>
<li><a href="#32">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">instid</b>%&gt;</a></li>
<li><a href="#33">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">operation</b> <i class="arg">opname</i> <i class="arg"><span class="opt">?param1 value1 param2 value2 ...?</span></i>%&gt;</a></li>
<li><a href="#34">&lt;%<b class="cmd">instance</b> <i class="arg">startref</i> <b class="cmd">selectRelated</b> <i class="arg">instsetvar</i> <i class="arg">rel1</i> <i class="arg"><span class="opt">?rel2 ...?</span></i>%&gt;</a></li>
<li><a href="#35">&lt;%<b class="cmd">instance</b> <i class="arg">startref</i> <b class="cmd">selectRelatedWhere</b> <i class="arg">instsetvar</i> <i class="arg">instref</i> <i class="arg">boolexpr</i> <i class="arg">rel1</i> <i class="arg"><span class="opt">?rel2 ...?</span></i>%&gt;</a></li>
<li><a href="#36">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">signal</b> <i class="arg">event</i> <i class="arg"><span class="opt">?name1 value1 name2 value2 ...?</span></i>%&gt;</a></li>
<li><a href="#37">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">update</b> <i class="arg"><span class="opt">?attr1 value1 ...?</span></i>%&gt;</a></li>
<li><a href="#38">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">add</b> <i class="arg">instref</i>%&gt;</a></li>
<li><a href="#39">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">cardinality</b>%&gt;</a></li>
<li><a href="#40">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">contains</b> <i class="arg">instref</i>%&gt;</a></li>
<li><a href="#41">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">empty</b>%&gt;</a></li>
<li><a href="#42">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">equal</b> <i class="arg">compareset</i>%&gt;</a></li>
<li><a href="#43">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">foreachInstance</b> <i class="arg">instref</i>%&gt; <i class="arg">body</i> <i class="arg">&lt;%end%&gt;</i></a></li>
<li><a href="#44">&lt;%<b class="cmd">instset</b> <i class="arg">resultset</i> <b class="cmd">intersect</b> <i class="arg">set1</i> <i class="arg">set2</i> <i class="arg"><span class="opt">?set3 ...?</span></i>%&gt;</a></li>
<li><a href="#45">&lt;%<b class="cmd">instset</b> <i class="arg">resultset</i> <b class="cmd">minus</b> <i class="arg">set1</i> <i class="arg">set2</i>%&gt;</a></li>
<li><a href="#46">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">notempty</b>%&gt;</a></li>
<li><a href="#47">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">notequal</b> <i class="arg">compareset</i>%&gt;</a></li>
<li><a href="#48">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">remove</b> <i class="arg">instref</i>%&gt;</a></li>
<li><a href="#49">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">selectOneInstance</b> <i class="arg">instref</i>%&gt;</a></li>
<li><a href="#50">&lt;%<b class="cmd">instset</b> <i class="arg">resultset</i> <b class="cmd">union</b> <i class="arg">set1</i> <i class="arg">set2</i> <i class="arg"><span class="opt">?set3 ...?</span></i>%&gt;</a></li>
<li><a href="#51">&lt;%<i class="arg">eentity</i> <i class="arg">operation</i> <i class="arg"><span class="opt">?param1 value1 ...?</span></i>%&gt;</a></li>
</ul>
</div>
</div>
<div id="section1" class="doctools_section"><h2><a name="section1">Description</a></h2>
<p>This manpage describes the <b class="cmd"><a href="micca.html">micca</a></b> embedded macro commands.
To aid in translating domain actions from action language into &quot;C&quot;,
a set of commands may be embedded into the &quot;C&quot; source code.
During code generation,
the embedded commands are expanded and replaced by the functionally
equivalent &quot;C&quot; code.
Note that embedded commands may <em>not</em> be nested.</p>
<p>The supplied embedded commands are intended to perform model level
actions and remove the need to remember and understand the detailed
&quot;C&quot; function interface to the run time.
For the following action language (from a state activity):</p>
<pre class="doctools_example">
Filling To Wash State Activity
------------------------------
# Fill the tub with wash water.
select one wc related by self-&gt;R4[WC]
select one ct related by self-&gt;R1[CT]
signal Fill(wc.WashWaterTemp) to ct
</pre>
<p>The translation using the embedded commands would appear as:</p>
<pre class="doctools_example">
state FillingToWash {} {
    // Fill the tub with wash water.
    &lt;%my findOneRelated wc R4%&gt;
    &lt;%my findOneRelated ct ~R1%&gt;
    &lt;%instance wc assign {WashWaterTemp washtemp}%&gt;
    &lt;%instance ct signal Fill temp washtemp%&gt;
}
</pre>
</div>
<div id="section2" class="doctools_section"><h2><a name="section2">Commands</a></h2>
<p>Commands are divided into sections depending upon to which model
level entity they refer.
Commands are categorized as:</p>
<ul class="doctools_itemized">
<li><p><span class="sectref"><a href="#section3">Class Operations</a></span></p></li>
<li><p><span class="sectref"><a href="#section4">Relationship Operations</a></span></p></li>
<li><p><span class="sectref"><a href="#section5">Instance Operations</a></span></p></li>
<li><p><span class="sectref"><a href="#section6">Instance Set Operations</a></span></p></li>
<li><p><span class="sectref"><a href="#section7">External Entity Operations</a></span></p></li>
</ul>
</div>
<div id="section3" class="doctools_section"><h2><a name="section3">Class Operations</a></h2>
<p>For every class in a domain,
a macro command is created that has the same name as the class.
That class command takes as its first argument a subcommand.
The various subcommands for classes are given in this section.</p>
<dl class="doctools_definitions">
<dt><a name="1">&lt;%<i class="arg">class</i> <b class="cmd">create</b> <i class="arg">instref</i> <i class="arg"><span class="opt">?attr1 value1 attr2 value2 ...?</span></i></a></dt>
<dd><p>The <b class="cmd">create</b> subcommand generates code to
synchronously create a new instance of <i class="arg">class</i>.
A reference to the instance is placed in the variable called, <i class="arg">instref</i>.
If <i class="arg">instref</i> has not been previously declared,
it is declared automatically.
The attributes of the newly created instance are set to the values given
by the <i class="arg">attrN / valueN</i> pairs.
All attributes of the instance must either be supplied a value 
as part of the invocation of the <b class="cmd">create</b> subcommand or
have default values declared for them as part of the class definition.
Any value given as an argument overrides any default value that might
have been defined for an attribute.
If <i class="arg">class</i> has an associated state model,
then the newly created instance is placed in the default initial state
that was defined for the state model.
No state activity is executed since the instance creation is done
synchronously.</p>
<pre class="doctools_example">
&lt;%Color create c Red 20 Green 30 Blue 100%&gt;
</pre>
</dd>
<dt><a name="2">&lt;%<i class="arg">class</i> <b class="cmd">createasync</b> <i class="arg">event</i> {<i class="arg"><span class="opt">?param1 value1 param2 value2 ...?</span></i>} <i class="arg"><span class="opt">?attr1 value1 attr2 value2 ...?</span></i></a></dt>
<dd><p>The <b class="cmd">createasync</b> subcommand generates code to
asynchronously create a new instance of <i class="arg">class</i> by signaling <i class="arg">event</i>
as a creation event.
Any parameters of the creation event are given by the
<i class="arg"><span class="opt">?paramN valueN?</span></i> pairs.
If the event has no parameters,
an empty list ({}) must be used as argument.
The attributes of the newly created instance are set to the values given
by the <i class="arg"><span class="opt">?attrN  valueN?</span></i> pairs.
All attributes of the instance must either be supplied a value 
as part of the invocation of the <b class="cmd">createasync</b> subcommand or
have default values declared for them as part of the class definition.
Any value given as an argument overrides any default value that might
have been defined for an attribute.
This command is only defined for classes that have a state model for which
creation events have been specified.
The instance is created and placed in its pseudo-initial state
awaiting delivery of <i class="arg">event</i>,
whereupon it will transition and execute a state activity.</p>
<pre class="doctools_example">
&lt;%Order createasync New_order {quantity 20} Customer {&quot;Fred&quot;} Account 2700%&gt;
</pre>
</dd>
<dt><a name="3">&lt;%<i class="arg">class</i> <b class="cmd">createin</b> <i class="arg">instref</i> <i class="arg">state</i> <i class="arg"><span class="opt">?attr1 value1 attr2 value2 ...?</span></i></a></dt>
<dd><p>The <b class="cmd">createin</b> subcommand generates code to
synchronously create a new instance of <i class="arg">class</i> and place it the
<i class="arg">state</i> state.
A reference to the instance is placed in the variable called, <i class="arg">instref</i>.
If <i class="arg">instref</i> has not been previously declared,
it is declared automatically.
The attributes of the newly created instance are set to the values given
by the <i class="arg">attrN / valueN</i> pairs.
All attributes of the instance must either be supplied a value 
as part of the invocation of the <b class="cmd">create</b> subcommand or
have default values declared for them as part of the class definition.
Any value given as an argument overrides any default value that might
have been defined for an attribute.
<i class="arg">Class</i> must have a state model and
the newly created instance has its initial state set to <i class="arg">state</i>.
No state activity is executed since the instance creation is done
synchronously.</p>
<pre class="doctools_example">
&lt;%WashingMachine createin wm Stopped %&gt;
</pre>
</dd>
<dt><a name="4">&lt;%<i class="arg">class</i> <b class="cmd">findByName</b> <i class="arg">instname</i> <i class="arg">instref</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">findByName</b> subcommand for a class generates code to
place an instance reference in the variable named, <i class="arg">instref</i>,
that refers to the class instance named, <i class="arg">instname</i>.
When instances are defined in the initial instance population,
they are given names and this command allows for computing directly an instance
reference to one of the named instances of the initial instance population.</p>
<pre class="doctools_example">
&lt;%Schedule findByName singleton sref%&gt;
</pre>
</dd>
<dt><a name="5">&lt;%<i class="arg">class</i> <b class="cmd">findWhere</b> <i class="arg">instref</i> <i class="arg">clause</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">findWhere</b> subcommand for a class generates code
to search the instances of <i class="arg">class</i>.
A reference to the first allocated instance of <i class="arg">class</i> for which
<i class="arg">clause</i> evaluates to <b class="cmd">true</b> is assigned to the
<i class="arg">instref</i> variable.
If the <i class="arg">instref</i> variable does not exist before invoking
<b class="cmd">findWhere</b>, then it is declared automatically.
If there are multiple instances where <i class="arg">clause</i> evaluates to <b class="cmd">true</b>,
then the one returned is arbitrary.
If <i class="arg">clause</i> never evaluates to <b class="cmd">true</b> then <i class="arg">instref</i> will have the
value of <b class="variable">NULL</b>.</p>
<pre class="doctools_example">
&lt;%Color findWhere nored {nored-&gt;Red == 0}%&gt;
if (nored != NULL) {
    &lt;%instance nored update Red 10%&gt;
}
</pre>
</dd>
<dt><a name="6">&lt;%<i class="arg">class</i> <b class="cmd">foreachInstance</b> <i class="arg">instref</i>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></dt>
<dd><p>The <b class="cmd">foreachInstance</b> subcommand generates
statements to iterate over the instances of
<i class="arg">class</i> assigning a reference to each instance to the variable
named, <i class="arg">instref</i>.
If the <i class="arg">instref</i> variable does not exist before invoking
<b class="cmd">foreachInstance</b>, then it is declared automatically
and with a scope local to the command.
The code statements contained in the <i class="arg">body</i> are then executed.
The <i class="arg">body</i> is terminated by a <b class="cmd">&lt;%end%&gt;</b> macro command.</p>
<pre class="doctools_example">
&lt;%Color foreachInstance c%&gt;
    &lt;%instance c attr Red%&gt; += 30 ;
&lt;%end%&gt;
</pre>
</dd>
<dt><a name="7">&lt;%<i class="arg">class</i> <b class="cmd">foreachWhere</b> <i class="arg">instref</i> <i class="arg">clause</i>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></dt>
<dd><p>The <b class="cmd">foreachWhere</b> subcommand generates statements to
iterate over the instances of <i class="arg">class</i>.
A reference to each 
instance for which <i class="arg">clause</i> evaluates to <em>true</em>,
is assigned to the variable named,
<i class="arg">instref</i>, and <i class="arg">body</i> is executed.
If the <i class="arg">instref</i> variable does not exist before invoking
<b class="cmd">foreachWhere</b>, then it is declared automatically
and with a scope local to the command.
The <i class="arg">body</i> is terminated by a <b class="cmd">&lt;%end%&gt;</b> macro command.</p>
<pre class="doctools_example">
&lt;%Color foreachWhere c {c-&gt;Red &lt; 30}%&gt;
    printf(&quot;low red color: %d\n&quot;, &lt;%instance c attr Red%&gt;) ;
    &lt;%instance c update Red 30%&gt;
&lt;%end%&gt;
</pre>
</dd>
<dt><a name="8">&lt;%<i class="arg">class</i> <b class="cmd">idtoref</b> <i class="arg">instid</i> <i class="arg">instref</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">idtoref</b> subcommand for a class generates code to 
convert the <i class="arg">instid</i> integer identifier of a class instance to
a reference to the instance stored in a variable named <i class="arg">instref</i>.
Outside of a domain,
class instances are identified by small integer numbers and when
passed into the domain,
this command converts them to actual instance references that can be used
in further processing.</p></dd>
<dt><a name="9">&lt;%<i class="arg">class</i> <b class="cmd">instset</b> <i class="arg">setvarname</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">instset</b> subcommand for a class generates code to
declare <i class="arg">setvarname</i> to be a variable whose type is
suitable to hold a set of instances of <i class="arg">class</i>.
The variable is initialized appropriately so that the set is empty.</p>
<pre class="doctools_example">
&lt;%Color instset highContrastColors%&gt;
</pre>
</dd>
<dt><a name="10">&lt;%<i class="arg">class</i> <b class="cmd">operation</b> <i class="arg">opname</i> <i class="arg"><span class="opt">?name1 value1 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">operation</b> subcommand for a class generates code to invoke
the class-based operation named <i class="arg">opname</i> passing the arguments
given by the <i class="arg">nameN valueN</i> pairs.
Operation argument passing is by name (rather than by order),
so the order of the name / value pairs is arbitrary and the generated
code will invoke the underlying &quot;C&quot; function properly.</p>
<pre class="doctools_example">
&lt;%Color addToBlue blueIncr 20%&gt; ;
</pre>
</dd>
<dt><a name="11">&lt;%<i class="arg">class</i> <b class="cmd">refvar</b> <i class="arg">refvarname</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">refvar</b> subcommand for a class generates code to
declare <i class="arg">refvarname</i> to be a variable whose type is suitable to hold
an instance reference to instances of <i class="arg">class</i>.
This command is not frequently used as most command will
automatically declare the necessary &quot;C&quot; variables.
However, it can be useful to declare an instance reference variable
to make sure it remains within a desired block scope.</p>
<pre class="doctools_example">
&lt;%Color instref mycolor%&gt;
</pre>
</dd>
<dt><a name="12">&lt;%<i class="arg">class</i> <b class="cmd">selectWhere</b> <i class="arg">instref</i> <i class="arg">clause</i> <i class="arg">instset</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">selectWhere</b> subcommand for a class generates code
to conditionally add instances of <i class="arg">class</i> to an instance set.
For each instance of <i class="arg">class</i>,
a reference to the instance is assigned to the <i class="arg">instref</i> variable
and <i class="arg">clause</i> is evaluated.
If the <i class="arg">instref</i> variable does not exist before invoking
<b class="cmd">selectWhere</b>, then it is declared automatically.
If <i class="arg">clause</i> evaluates to true,
then the instance is added to the set being accumulated in
the <i class="arg">instset</i> variable.
The <i class="arg">instset</i> variable is declared automatically if necessary.</p>
<pre class="doctools_example">
&lt;%Color selectWhere lowred {lowred-&gt;Red &lt; 30} lrset%&gt;
if (&lt;%instset lrset empty%&gt;) {
    printf(&quot;no low red colors\n&quot;) ;
}
</pre>
</dd>
</dl>
</div>
<div id="section4" class="doctools_section"><h2><a name="section4">Relationship Operations</a></h2>
<p>Each relationship defined by a domain will have a command by the
same name created.
Those relationship commands have subcommands that depend upon the type
of the relationship.
These fall into four categories:</p>
<ul class="doctools_itemized">
<li><p>Associations</p></li>
<li><p>Associations that also have a single assigner</p></li>
<li><p>Associations that also have a multiple assigner</p></li>
<li><p>Generalizations</p></li>
</ul>
<p>The following section show the subcommands available for each category.</p>
<div id="subsection1" class="doctools_subsection"><h3><a name="subsection1">Association Operations</a></h3>
<p>All association relationship have a single command, <b class="cmd">reference</b>,
defined for them.
The interpretation of <b class="cmd">reference</b> is slightly different for
simple associations than for class based associations.
Associations may also have an assigner defined on them and, if so,
additional commands are available for the assigner operations.</p>
</div>
<div id="subsection2" class="doctools_subsection"><h3><a name="subsection2">Simple Association Operations</a></h3>
<dl class="doctools_definitions">
<dt><a name="13">&lt;%<i class="arg">association</i> <b class="cmd">reference</b> <i class="arg">sourceref</i> <i class="arg">targetref</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">reference</b> subcommand when applied to simple associations
updates the referenced instance for the association.
The <i class="arg">sourceref</i> argument is the name of a &quot;C&quot; variable that holds a
reference to an instance of the class playing the role of the referring
class in the association.
The <i class="arg">targetref</i> argument is the name of a &quot;C&quot; variable that holds a
reference to an instance of the class playing the role of the
referenced class in the association.
The <b class="cmd">reference</b> subcommand removes any existing referenced instance
in the association and replaces it with the <i class="arg">targetref</i> instance.</p>
<p>For a simple association, <b class="variable">R3</b>, defined as:</p>
<pre class="doctools_example">
association R3 Member 0..*--1 Group
</pre>
<p>In <b class="variable">R3</b>, Member is the referring class and Group is the referenced class.
Then if <b class="variable">groupref</b> contains an instance reference to a Group and
<b class="variable">memberref</b> contains an instance reference to a Member, then:</p>
<pre class="doctools_example">
R3 reference memberref groupref
</pre>
<p>changes the instance of <b class="variable">memberref</b> so that it refers to
<b class="variable">groupref</b>.</p></dd>
</dl>
</div>
<div id="subsection3" class="doctools_subsection"><h3><a name="subsection3">Class Based Association Operations</a></h3>
<dl class="doctools_definitions">
<dt><a name="14">&lt;%<i class="arg">association</i> <b class="cmd">reference</b> <i class="arg">assocref</i> <i class="arg">partref</i> <i class="arg"><span class="opt">?direction?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">reference</b> subcommand when applied to class based associations
updates the referenced instance of one of the participants
in the association.
The <i class="arg">assocref</i> argument is the name of a &quot;C&quot; variable that holds a
reference to an instance from the class that is the associator
class in the association.
The <i class="arg">partref</i> argument is the name of a &quot;C&quot; variable that holds a
reference to an instance from the class that is one of the participant
in the association.
The <b class="cmd">reference</b> subcommand removes any existing references to
the participant in the association and replaces it with the
<i class="arg">partref</i> instance.
For a reflexive class based association,
the <i class="arg">direction</i> argument must be supplied as either <b class="variable">forward</b>
or <b class="variable">backward</b>.
This indicates that the <b class="cmd">reference</b> operation should be applied to the
instance in either the forward or backward direction of
the association traversal.
Since the name of the participant classes in a reflexive association
are the same,
the <i class="arg">direction</i> argument is used to disambiguate the which
side <i class="arg">partref</i> refers to.</p>
<p>For a class based association, <b class="variable">R4</b>, defined as:</p>
<pre class="doctools_example">
association R4 -associator Membership Member 0..*--1..* Group
</pre>
<p>In <b class="variable">R4</b>, Membership is the associator class.
Then if <b class="variable">mshipref</b> contains a reference to a Membership instance and
<b class="variable">memberref</b> contains a reference to a Member instance, then:</p>
<pre class="doctools_example">
R4 reference mshipref memberref
</pre>
<p>changes the instance of <b class="variable">mshipref</b> so that it refers to
<b class="variable">memberref</b>.</p></dd>
</dl>
</div>
<div id="subsection4" class="doctools_subsection"><h3><a name="subsection4">Single Assigner Association Operations</a></h3>
<p>Associations that are also single assigners have an additional
command defined for them in order to signal events to the assigner.</p>
<dl class="doctools_definitions">
<dt><a name="15">&lt;%<i class="arg">association</i> <b class="cmd">signal</b> <i class="arg">event</i> <i class="arg"><span class="opt">?name1 value1 name2 value2 ...?</span></i>%&gt;</a></dt>
<dd><p>For associations that have a single assigner,
the <b class="cmd">signal</b> command signals <i class="arg">event</i> to the assigner.
If any of the <i class="arg">nameN / valueN</i> arguments are present,
they are passed as the parameters to <i class="arg">event</i>.
All parameters required by the event must be supplied and
the parameter names must match those of the signature of the event.
Event parameters are passed by name,
so the ordering of the <i class="arg">nameN valueN</i> pairs is not significant.</p></dd>
</dl>
</div>
<div id="subsection5" class="doctools_subsection"><h3><a name="subsection5">Multiple Assigner Association Operations</a></h3>
<p>For associations that are multiple assigners,
two additional commands are defined.
Note that there is no <b class="cmd">signal</b> command for a multiple assigner.
Once an instance of the assigner is found using the
<b class="cmd">findByIdInstance</b> command, it is signaled like any other
instance, <em>i.e.</em> using &lt;%instance <i class="arg">instref</i> signal <i class="arg">event</i>%&gt;.</p>
<dl class="doctools_definitions">
<dt><a name="16">&lt;%<i class="arg">association</i> <b class="cmd">create</b> <i class="arg">instref</i> <i class="arg">idinst</i>%&gt;</a></dt>
<dd></dd>
<dt><a name="17">&lt;%<i class="arg">association</i> <b class="cmd">findByIdInstance</b> <i class="arg">idinst</i> <i class="arg">instref</i>%&gt;</a></dt>
<dd></dd>
</dl>
</div>
<div id="subsection6" class="doctools_subsection"><h3><a name="subsection6">Generalization Operations</a></h3>
<p>For generalization relationships,
two commands are defined.</p>
<dl class="doctools_definitions">
<dt><a name="18">&lt;%<i class="arg">generalization</i> <b class="cmd">classify</b> <i class="arg">superref</i> <i class="arg">subref</i>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></dt>
<dd></dd>
<dt><a name="19">&lt;%<b class="cmd">subclass</b> <i class="arg">classname</i>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></dt>
<dd></dd>
<dt><a name="20">&lt;%<b class="cmd">default</b>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></dt>
<dd><p>The <b class="cmd">classify</b> subcommand navigates the <i class="arg">generalization</i>
relationship to the currently related subclass instance.
The <i class="arg">superref</i> argument is the name of a variable holding
a reference to a superclass instance of <i class="arg">generalization</i>.
The <i class="arg">subref</i> argument is the name of variable into which a reference
to the currently related subclass instance of <i class="arg">superref</i> is placed.
The type of <i class="arg">subref</i> will be declared automatically as the type
of the currently related subclass instance.
The <i class="arg">body</i> of the <b class="cmd">classify</b> command must consist of invocations
of &lt;%<b class="cmd">subclass</b> <i class="arg">classname</i>%&gt; or &lt;%<b class="cmd">default</b>%&gt; commands.
The subclass of the instance currently related to <i class="arg">superref</i> is
matched against the <i class="arg">classnames</i> given in the <b class="cmd">subclass</b>
commands of the body.
Upon finding a match,
<i class="arg">subref</i> is declared to be of the corresponding <i class="arg">classname</i>
type, set to refer to the related subclass and then the
<i class="arg">body</i> of the corresponding <b class="cmd">subclass</b> command is executed.
The scope of <i class="arg">subref</i> is local to the matching <i class="arg">body</i> statements.
If the currently related instance does not match any of the
<i class="arg">classnames</i> given in <b class="cmd">subclass</b> commands,
then the body of the <b class="cmd">default</b> command is executed.
In the <b class="cmd">default</b> case,
<i class="arg">subref</i> is not defined.
If there is no match and no <b class="cmd">default</b> command is given,
then nothing is executed.
Note it is not necessary to give a <b class="cmd">default</b> command body if
all of the subclasses of <i class="arg">generalization</i> are specified in
<b class="cmd">subclass</b> commands.
A warning is issued if some subclasses of <i class="arg">generalization</i> are missing
from <b class="cmd">subclass</b> commands and no <b class="cmd">default</b> command is given.
Note that it is <em>not</em> necessary to place a &quot;C&quot; <b class="variable">break</b> statement
as part of the body of a <b class="cmd">subclass</b> or <b class="cmd">default</b> command.</p>
<pre class="doctools_example">
&lt;%R17 classify lampref sublampref%&gt;
    &lt;%subclass TableLamp%&gt;
        &lt;%instance update sublampref Color red%&gt;
    &lt;%end%&gt;
    &lt;%subclass FloorLamp%&gt;
        &lt;%instance update sublampref Height 7%&gt;
    &lt;%end%&gt;
    &lt;%subclass DeskLamp%&gt;
        &lt;%instance update sublampref Wattage 100%&gt;
    &lt;%end%&gt;
&lt;%end%&gt;
</pre>
</dd>
<dt><a name="21">&lt;%<i class="arg">generalization</i> <b class="cmd">reclassify</b> <i class="arg">subref</i> <i class="arg">newsubclass</i> <i class="arg">newsubref</i> <i class="arg"><span class="opt">?attr1 value1 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">reclassify</b> subcommand changes the type of the subclass instance
in the <i class="arg">subref</i> variable to be an instance of <i class="arg">newsubclass</i>.
A reference to the new subclass instance is place in a variable named
<i class="arg">newsubref</i>.
The <i class="arg">newsubref</i> instance refers to the same superclass instance
as <i class="arg">subref</i> did.
After the reclassification has happened, the instance referred to by
<i class="arg">subref</i> no long exists (it was deleted as part of the reclassification)
and its instance reference variable may not be used.
The <i class="arg">newsubref</i> variable is created automatically if needed.
The newly created instance of <i class="arg">newsubclass</i> has its attributes
initialized by the <i class="arg">attrN / valueN</i> pairs.
All attributes of the new subclass instance must either be supplied a value 
as part of the invocation of the <b class="cmd">reclassify</b> subcommand or
have default values declared for them as part of the class definition.
Any value given as an argument overrides any default value that might
have been defined for an attribute.</p>
<pre class="doctools_example">
/*
 * Create a Lamp instance and one of its corresponding subclass instances.
 */
&lt;%Lamp create lampref%&gt;
&lt;%TableLamp create tableref Color blue R17 lampref%&gt;
/*
 * Reclassify the table lamp instance into a desk lamp instance.
 */
&lt;%R17 reclassify tableref DeskLamp deskref Wattage 70%&gt;
/*
 * &quot;deskref&quot; now refers to &quot;lampref&quot; across R17 and
 * &quot;tableref&quot; no longer exists.
 */
</pre>
</dd>
</dl>
</div>
</div>
<div id="section5" class="doctools_section"><h2><a name="section5">Instance Operations</a></h2>
<p>The <b class="cmd">instance</b> command performs operations on instances.
The first argument to the <b class="cmd">instance</b> command is always the name
of a &quot;C&quot; variable that contains a reference to the instance.
The second argument is the name of a subcommand operation to be performed
on the instance.</p>
<dl class="doctools_definitions">
<dt><a name="22">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">assign</b> <i class="arg"><span class="opt">?assignspec1 assignspec2 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">assign</b> subcommand assigns attribute values of the instance
referenced by the value of the <i class="arg">instref</i> variable into
ordinary &quot;C&quot; variables.
Each <i class="arg">assignspecN</i> argument consists of one or two elements.
If the <i class="arg">assignspecN</i> argument consist of one element,
then it must be the name of an attribute and a &quot;C&quot; variable by 
the same name is declared and the corresponding attribute from
<i class="arg">instref</i> is assigned to it.
If the <i class="arg">assignspecN</i> argument consists of two elements,
then the first element must be the name of an attribute and the
second element will be used as the name of a &quot;C&quot; variable
into which the corresponding attribute value is assigned.
If no <i class="arg">assignspecN</i> arguments are given,
then all the attributes of <i class="arg">instref</i> are assigned to
variables whose names are the same as the attribute name.</p>
<pre class="doctools_example">
&lt;%instance c assign Red Blue {Green mygreen}%&gt;
if (Blue &gt; mygreen) {
    printf(&quot;this one is more blue than green\n&quot;) ;
}
</pre>
</dd>
<dt><a name="23">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">attr</b> <i class="arg">name</i>%&gt;</a></dt>
<dd><p>The <i class="arg">attr</i> subcommand generate &quot;C&quot; code suitable for using as
an lvalue or an rvalue to access the <i class="arg">name</i> attribute of
the instance refered to by the <i class="arg">instref</i> variable.
If <i class="arg">name</i> is not an attribute of the class of <i class="arg">instref</i>,
then an error is reported.</p>
<pre class="doctools_example">
&lt;%instance c attr Total%&gt; = &lt;%instance c attr Red%&gt; + &lt;%instance c attr Blue%&gt; ;
</pre>
</dd>
<dt><a name="24">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">canceldelayed</b> <i class="arg">event</i> <i class="arg"><span class="opt">?sourceinst?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">canceldelayed</b> subcommand arranges for <i class="arg">event</i> to
not be delivered to the instance referenced by <i class="arg">instref</i>.
The <i class="arg">sourcinst</i> argument is a &quot;C&quot; variable name holding a reference
to the instance that originally signaled <i class="arg">event</i>.
If <i class="arg">sourceinst</i> is not supplied,
then the signaling instance is taken as <b class="variable">self</b> if invoked within
as state activity and <b class="variable">NULL</b> otherwise.
After being canceled, <i class="arg">event</i> will not be dispatched.
It is not an error to cancel an event that does not exist
or has already been dispatched.
Only event that were signaled as delayed events may be canceled.</p>
<pre class="doctools_example">
&lt;%instance c canceldelayed Start%&gt;
</pre>
</dd>
<dt><a name="25">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">delayremaining</b> <i class="arg">event</i> <i class="arg"><span class="opt">?sourceinst?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">delayremaining</b> subcommand generates an rvalue expression
of type <b class="type">MRT_DelayTime</b>
that evaluates to the number of milliseconds before <i class="arg">event</i>
will be signaled.
The <i class="arg">sourcinst</i> argument is a &quot;C&quot; variable name holding a reference
to the instance that originally signaled <i class="arg">event</i>.
If <i class="arg">sourceinst</i> is not supplied,
then the signaling instance is taken as <b class="variable">self</b> if invoked within
as state activity and <b class="variable">NULL</b> otherwise.
A return value of zero implies that <i class="arg">event</i> has already been
dispatched or does not exist.</p>
<pre class="doctools_example">
MRT_DelayTime newtime = &lt;%instance c delayremaining Start%&gt; + 100 ;
&lt;%instance c canceldelayed Start%&gt;
&lt;%instance c delaysignal newtime Start%&gt;
</pre>
</dd>
<dt><a name="26">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">delaysignal</b> <i class="arg">time</i> <i class="arg">event</i> <i class="arg"><span class="opt">?name1 value1 name2 value2 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">delaysignal</b> subcommand arranges for <i class="arg">event</i>
to be signaled to the instance
referenced by the <i class="arg">instref</i> variable no sooner than
<i class="arg">time</i> in the future.
If <i class="arg">time</i> is given as zero,
then the event is signalled immediately.
If any of the <i class="arg">nameN valueN</i> arguments are present,
they are passed as the parameters to <i class="arg">event</i>.
All parameters required by the event must be supplied and
the parameter names must match those of the signature of the event.
Event parameters are passed by name,
so the ordering of the <i class="arg">nameN valueN</i> pairs is not significant.</p>
<pre class="doctools_example">
&lt;%instance c delaysignal 100 Start%&gt;
</pre>
</dd>
<dt><a name="27">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">delete</b>%&gt;</a></dt>
<dd><p>The <b class="cmd">delete</b> subcommand deletes the instance referenced by
the value of the <i class="arg">instref</i> variable.</p></dd>
<dt><a name="28">&lt;%<b class="cmd">instance</b> <i class="arg">startref</i> <b class="cmd">findOneRelated</b>&gt; <i class="arg">instref</i> <i class="arg">rel1</i> <i class="arg"><span class="opt">?rel2 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">findOneRelated</b> subcommand obtains a single instance by navigating
the relationship chain which starts at <i class="arg">startref</i> and is given
by the <i class="arg">relN</i> arguments.
The form of the <i class="arg">relN</i> arguments is the same as for the <b class="cmd">foreachRelated</b>
subcommand.
A reference to the related instance is assigned into the <i class="arg">instref</i>
variable.
If no related instance is found, <em>i.e.</em> the relationship chain
is conditional,
then <i class="arg">instref</i> will have the value of <b class="variable">NULL</b>.
If the navigation of the relationship chain would yield more than one
instance, then an error is reported.
This subcommand is a convenience function when it is known that
at most one instance can result from navigating the relationships chain.</p>
<pre class="doctools_example">
&lt;%instance ct findOneRelated wm R1%&gt;
</pre>
</dd>
<dt><a name="29">&lt;%<b class="cmd">instance</b> <i class="arg">startref</i> <b class="cmd">findRelatedWhere</b> <i class="arg">instref</i> <i class="arg">boolexpr</i> <i class="arg">rel1</i> <i class="arg"><span class="opt">?rel2 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">findRelatedWhere</b> subcommand obtains a single instance by navigating
the relationship chain which starts at <i class="arg">startref</i> and is given
by the <i class="arg">relN</i> arguments.
The form of the <i class="arg">relN</i> arguments is the same as for the <b class="cmd">foreachRelated</b>
subcommand.
A reference to each related instance is assigned into the <i class="arg">instref</i>
variable and <i class="arg">boolexpr</i> is evaluated.
If <i class="arg">boolexpr</i> evaluates to non-zero,
then the iteration stops and <i class="arg">instref</i> contains a reference to
the matching instance.
If no match is found or there are no related instances,
<i class="arg">instref</i> is set to NULL.
If there are multiple matching instances in the related set of instances,
the one found is arbitrary.</p>
<pre class="doctools_example">
&lt;%instance ct findRelatedWhere mtr {mrt-&gt;MotorID == MTR_Pump} ~R2%&gt;
</pre>
</dd>
<dt><a name="30">&lt;%<b class="cmd">instance</b> <i class="arg">startref</i> <b class="cmd">foreachRelated</b> <i class="arg">instref</i> <i class="arg">rel1</i> <i class="arg"><span class="opt">?rel2 ...?</span></i>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></dt>
<dd><p>The <b class="cmd">foreachRelated</b> subcommand iterates across the set of
instances obtained by navigating the relationships chain which
begins at <i class="arg">startref</i> and is given by the <i class="arg">relN</i> arguments.
A reference to each instance found is assigned to the <i class="arg">instref</i> variable
and <i class="arg">body</i> is executed.
The <i class="arg">body</i> is terminated by a <b class="cmd">&lt;%end%&gt;</b> macro command.
The scope of the <i class="arg">instref</i> variable is confined to the statements
in <i class="arg">body</i> unless it was previously declared.
The <i class="arg">relN</i> arguments specify the relationship navigation and
are of the form:</p>
<ul class="doctools_itemized">
<li><p><b class="cmd">R</b><em>dd</em> traversing relationship Rdd in the forward direction.</p></li>
<li><p><b class="cmd">~R</b><em>dd</em> traversing relationship Rdd in the reverse direction.</p></li>
<li><p>{<b class="cmd">R</b><em>dd</em> <i class="arg">class</i>}
traversing relationship Rdd in the forward direction and stopping at
<i class="arg">class</i>.</p></li>
<li><p>{<b class="cmd">~R</b><em>dd</em> <i class="arg">class</i>}
traversing relationship Rdd in the reverse direction and stopping at
<i class="arg">class</i>.</p></li>
</ul>
<p>where <b class="cmd">~R</b><em>dd</em> follows our usual naming conventions for
relationships, the letter &quot;R&quot; followed by decimal digits
(<em>e.g.</em> <b class="variable">R27</b>) ;</p>
<pre class="doctools_example">
&lt;%instance color foreachRelated pigm R23 ~R47 {R13 Pigment}%&gt;
    printf(&quot;found pigment, %s\n&quot;, &lt;%instance pigm attr Name%&gt;) ;
&lt;%end%&gt;
</pre>
</dd>
<dt><a name="31">&lt;%<b class="cmd">instance</b> <i class="arg">startref</i> <b class="cmd">foreachRelatedWhere</b> <i class="arg">instref</i> <i class="arg">boolexpr</i> <i class="arg">rel1</i> <i class="arg"><span class="opt">?rel2 ...?</span></i>%&gt; <i class="arg">body</i> &lt;%end%&gt;</a></dt>
<dd><p>The <b class="cmd">foreachRelatedWhere</b> subcommand conditionally iterates across the set
of instances obtained by navigating the relationships chain which begins at
<i class="arg">startref</i> and is given by the <i class="arg">relN</i> arguments.
A reference to each instance found is assigned to the <i class="arg">instref</i> variable
and <i class="arg">boolexpr</i> is evaluated.
If <i class="arg">boolexpr</i> evaluates to true (or non-zero), then <i class="arg">body</i> is executed.
The <i class="arg">body</i> is terminated by a <b class="cmd">&lt;%end%&gt;</b> macro command.
The scope of the <i class="arg">instref</i> variable is confined to the statements
in <i class="arg">body</i> unless it was previously declared.
The <i class="arg">relN</i> arguments specify the relationship navigation and
are of the same form as for the <b class="cmd">foreachRelated</b> subcommand.</p>
<pre class="doctools_example">
&lt;%instance color foreachRelatedWhere pigm {pigm-&gt;Amount &gt; 20} R23 ~R47 {R13 Pigment}%&gt;
    printf(&quot;found pigment, %s\n&quot;, &lt;%instance pigm attr Name%&gt;) ;
&lt;%end%&gt;
</pre>
</dd>
<dt><a name="32">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">instid</b>%&gt;</a></dt>
<dd><p>The <b class="cmd">instid</b> subcommand generates a &quot;C&quot; rvalue expression of unsigned type
that computes a small integer identifier for the instance reference held in the
<i class="arg">instref</i> variable.
The identifer values are sequential and
range from 0 to the number of instances of the
class of <i class="arg">instref</i> minus one.
These numeric id's are useful for identifying instances outside
of their domain and may be passed to the <i class="arg">class</i> <b class="cmd">idtoref</b>
command to recover the value of the instance reference.</p>
<pre class="doctools_example">
unsigned cid = &lt;%instance color instid%&gt; ;
&lt;%Color mapcolor Color cid%&gt; ;
</pre>
</dd>
<dt><a name="33">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">operation</b> <i class="arg">opname</i> <i class="arg"><span class="opt">?param1 value1 param2 value2 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">operation</b> command generates a &quot;C&quot; rvalue expression that
invokes the instance based operation, <i class="arg">opname</i>,
passing the <i class="arg">paramN</i> values as arguments.
Parameter arguments must appear as parameter name / value pairs
and the parameter names must match that of the signature of <i class="arg">opname</i>.
All parameters must be supplied values and the parameter name / value
pairs may in any order.
The value of the <i class="arg">instref</i> references will become the value of
<b class="variable">self</b> when the operation is invoked.</p>
<pre class="doctools_example">
&lt;%instance color operation incrRed incrAmount 20%&gt; ;
</pre>
</dd>
<dt><a name="34">&lt;%<b class="cmd">instance</b> <i class="arg">startref</i> <b class="cmd">selectRelated</b> <i class="arg">instsetvar</i> <i class="arg">rel1</i> <i class="arg"><span class="opt">?rel2 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">selectRelated</b> subcommand operates the same way as the
<b class="cmd">foreachRelated</b> subcommand, except the instances found during the
relationship chain navigation are added to the instance set held in the
<i class="arg">instsetvar</i> variable.</p>
<pre class="doctools_example">
&lt;%instance color selectRelated pigmset R23 ~R47 {R13 Pigment}%&gt;
</pre>
</dd>
<dt><a name="35">&lt;%<b class="cmd">instance</b> <i class="arg">startref</i> <b class="cmd">selectRelatedWhere</b> <i class="arg">instsetvar</i> <i class="arg">instref</i> <i class="arg">boolexpr</i> <i class="arg">rel1</i> <i class="arg"><span class="opt">?rel2 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">selectRelatedWhere</b> subcommand operates the same way as the
<b class="cmd">foreachRelatedWhere</b> subcommand, except the instances found during the
relationship chain navigation are added to the instance set held in the
<i class="arg">instsetvar</i> variable.</p>
<pre class="doctools_example">
&lt;%instance color selectRelatedWhere pigmset pigm {pigm-&gt;Amount &gt; 20} R23 ~R47 {R13 Pigment}%&gt;
</pre>
</dd>
<dt><a name="36">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">signal</b> <i class="arg">event</i> <i class="arg"><span class="opt">?name1 value1 name2 value2 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">signal</b> subcommand signals <i class="arg">event</i> to the instance
referenced by the <i class="arg">instref</i> variable.
If any of the <i class="arg">nameN / valueN</i> arguments are present,
they are passed as the parameters to <i class="arg">event</i>.
All parameters required by the event must be supplied and
the parameter names must match those of the signature of the event.
Event parameters are passed by name,
so the ordering of the <i class="arg">nameN valueN</i> pairs is not significant.</p>
<pre class="doctools_example">
&lt;%instance c signal Start%&gt;
</pre>
</dd>
<dt><a name="37">&lt;%<b class="cmd">instance</b> <i class="arg">instref</i> <b class="cmd">update</b> <i class="arg"><span class="opt">?attr1 value1 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">update</b> subcommand updates the values of the attributes
of the instance referenced by the value of the <i class="arg">instref</i> variable.
Attributes and corresponding values are given in pairs.
The <i class="arg">valueN</i> arguments may be any &quot;C&quot; rvalue expression.</p>
<pre class="doctools_example">
&lt;%instance c update Red 20 Blue 30 Green 40%&gt;
&lt;%instance d update Red {20 * 3}%&gt;
</pre>
</dd>
</dl>
</div>
<div id="section6" class="doctools_section"><h2><a name="section6">Instance Set Operations</a></h2>
<p>The <b class="cmd">instset</b> command performs operations on instance sets.
Instance sets are sets of instance references where all the instances
are of the same class.
Instance sets are created by the class <b class="cmd">instset</b> and <b class="cmd">selectWhere</b>
commands and the instance <b class="cmd">selectRelated</b> and <b class="cmd">selectRelatedWhere</b>
commands.
The first argument to the <b class="cmd">instset</b> command is always the name
of a &quot;C&quot; variable that contains an instance set.
The second argument is the name of a subcommand operation to be performed
on the instance set.</p>
<dl class="doctools_definitions">
<dt><a name="38">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">add</b> <i class="arg">instref</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">add</b> subcommand adds the instance reference contained in the
variable named, <i class="arg">instref</i>, to the instance reference set
contained in the variable named, <i class="arg">instsetvar</i>.
The <i class="arg">instref</i> instance must be of the same class as the other instance
references in <i class="arg">instsetvar</i>.
Adding a duplicate member to the set is silently ignored and the
set property of <i class="arg">instsetvar</i> is maintained.</p></dd>
<dt><a name="39">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">cardinality</b>%&gt;</a></dt>
<dd><p>The <b class="cmd">cardinality</b> subcommand generates a &quot;C&quot; unsigned rvalue expression
which evaluates to the number of members of the instance reference set
contained it the variable named, <i class="arg">instsetvar</i>.</p>
<pre class="doctools_example">
&lt;%Color selectWhere color {color-&gt;Blue &lt; 30 &amp;&amp; color-&gt;Red &gt; 100} brcolors%&gt;
printf(&quot;%u blue / red colors present\n&quot;, &lt;%instset brcolors cardinality%&gt;) ;
</pre>
</dd>
<dt><a name="40">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">contains</b> <i class="arg">instref</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">contains</b> subcommand generates a &quot;C&quot; boolean rvalue expression
which evaluates to <em>true</em> if the instance reference contained in
the variable named, <i class="arg">instref</i>, is a member of the instance reference
set contained in the variable named, <i class="arg">instsetvar</i>, and <em>false</em>
otherwise.
The instance referenced by <i class="arg">instref</i> must be of the same class
as the references in <i class="arg">instsetvar</i>.</p></dd>
<dt><a name="41">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">empty</b>%&gt;</a></dt>
<dd><p>The <b class="cmd">empty</b> subcommand generates a &quot;C&quot; boolean rvalue expression which
evaluates to <em>true</em> if if the instance reference set contained in the
variable named, <i class="arg">instsetvar</i>, has no members and <em>false</em> otherwise.</p>
<pre class="doctools_example">
&lt;%Color selectWhere color {color-&gt;Blue &lt; 30} lowblues%&gt;
if (&lt;%instset lowblues empty%&gt;) {
    &lt;%Color create lb Red 10 Blue 30 Green 50%&gt;
}
</pre>
</dd>
<dt><a name="42">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">equal</b> <i class="arg">compareset</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">equal</b> subcommand generates a &quot;C&quot; boolean rvalue expression which
evaluates to <em>true</em> if if the instance reference set contained in the
variable named, <i class="arg">instsetvar</i>, is equal to the one contained in the variable
named, <i class="arg">compareset</i> and <em>false</em> otherwise.
For two instance reference sets to be equal the sets must
be sets of the same class as well as contain the same instances of
that class.</p></dd>
<dt><a name="43">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">foreachInstance</b> <i class="arg">instref</i>%&gt; <i class="arg">body</i> <i class="arg">&lt;%end%&gt;</i></a></dt>
<dd><p>The <b class="cmd">foreachInstance</b> subcommand iterates over the members of the
instance reference set contained in the variable named <i class="arg">instsetvar</i>.
Each instance reference in the set is assigned to the variable named,
<i class="arg">instref</i> and <i class="arg">body</i> is executed.
The <i class="arg">&lt;%end%&gt;</i> command terminates the <i class="arg">body</i> statements.
The order of the iteration over the set is unspecified and should
be considered arbitrary.</p>
<pre class="doctools_example">
&lt;%Color selectWhere color {color-&gt;Red &gt; 30} highreds%&gt;
&lt;%instset highreds foreachInstance highred%&gt;
    &lt;%instance highred assign {Red redValue}%&gt;
    &lt;%instance highred update Red {redValue - 20}%&gt;
&lt;%end%&gt;
</pre>
</dd>
<dt><a name="44">&lt;%<b class="cmd">instset</b> <i class="arg">resultset</i> <b class="cmd">intersect</b> <i class="arg">set1</i> <i class="arg">set2</i> <i class="arg"><span class="opt">?set3 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">intersect</b> subcommand computes the set intersection of the instance
references contained in the <i class="arg">setN</i> variables and stores the
result in the variable named, <i class="arg">resultset</i>.
The <i class="arg">resultset</i> variable is declared if it does not already exist.
All of the <i class="arg">setN</i> instance sets must refer to instances of the same
class.
The order of the appearance of the <i class="arg">setN</i> arguments does not
affect the result.</p></dd>
<dt><a name="45">&lt;%<b class="cmd">instset</b> <i class="arg">resultset</i> <b class="cmd">minus</b> <i class="arg">set1</i> <i class="arg">set2</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">minus</b> subcommand computes the set difference between the
instance reference set held in the <i class="arg">set1</i> variable and the
instance reference set held in the <i class="arg">set2</i> variable.
The order of the arguments is significant as <i class="arg">set1</i> is treated as
the minuend and <i class="arg">set2</i> is treated as the subtrahend
(<em>i.e.</em> <b class="cmd">minus</b> computes <i class="arg">set1</i> - <i class="arg">set2</i>).</p></dd>
<dt><a name="46">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">notempty</b>%&gt;</a></dt>
<dd><p>The <b class="cmd">notempty</b> subcommand generates a &quot;C&quot; boolean rvalue expression which
evaluates to <em>true</em> if if the instance reference set contained in
the variable named, <i class="arg">instsetvar</i>, has at least one member
and <em>false</em> otherwise.</p></dd>
<dt><a name="47">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">notequal</b> <i class="arg">compareset</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">notequal</b> subcommand generates a &quot;C&quot; boolean rvalue expression which
evaluates to <em>true</em> if if the instance reference set contained in the
variable named, <i class="arg">instsetvar</i>, is not equal to the one contained in the
variable named, <i class="arg">compareset</i> and <em>false</em> otherwise.</p></dd>
<dt><a name="48">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">remove</b> <i class="arg">instref</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">remove</b> subcommand removes the instance reference contained in the
variable named, <i class="arg">instref</i>, from the instance reference set
contained in the variable named, <i class="arg">instsetvar</i>.
The <i class="arg">instref</i> instance must be of the same class as the other instance
references in <i class="arg">instsetvar</i>.
Removing an instance reference that is not a member of the
<i class="arg">instsetvar</i> set is silently ignored.</p></dd>
<dt><a name="49">&lt;%<b class="cmd">instset</b> <i class="arg">instsetvar</i> <b class="cmd">selectOneInstance</b> <i class="arg">instref</i>%&gt;</a></dt>
<dd><p>The <b class="cmd">selectOneInstance</b> subcommand
selects one arbitrary instance from the <i class="arg">instsetvar</i> instance set.
A reference to the selected instance is assigned to <i class="arg">instref</i>.
If <i class="arg">instsetvar</i> is empty, then <i class="arg">instvar</i> is set to <b class="variable">NULL</b>.
If <i class="arg">instavarset</i> contains more than one instance,
the instance reference assigned to <i class="arg">instref</i> is chosen arbitrarily
from the set.</p></dd>
<dt><a name="50">&lt;%<b class="cmd">instset</b> <i class="arg">resultset</i> <b class="cmd">union</b> <i class="arg">set1</i> <i class="arg">set2</i> <i class="arg"><span class="opt">?set3 ...?</span></i>%&gt;</a></dt>
<dd><p>The <b class="cmd">union</b> subcommand computes the set union of the instance
references contained in the <i class="arg">setN</i> variables and stores the
result in the variable named, <i class="arg">resultset</i>.
The <i class="arg">resultset</i> variable is declared if it does not already exist.
All of the <i class="arg">setN</i> instance sets must refer to instances of the same
class.
The order of the appearance of the <i class="arg">setN</i> arguments does not
affect the result.</p>
<pre class="doctools_example">
&lt;%Color selectWhere lowred {lowred-&gt;Red &lt; 30} lrset%&gt;
&lt;%Color selectWhere highgreen {highgreen &gt; 60} hgset%&gt;
&lt;%instset lhset union lrset hgset%&gt;
</pre>
</dd>
</dl>
</div>
<div id="section7" class="doctools_section"><h2><a name="section7">External Entity Operations</a></h2>
<p>For each external entity defined by the <b class="cmd">eentity</b> command
in the domain configuration,
a macro command is defined by the same name.
For each external entity operation defined on an external entity,
a subcommand is defined that is used to invoke the operation.</p>
<dl class="doctools_definitions">
<dt><a name="51">&lt;%<i class="arg">eentity</i> <i class="arg">operation</i> <i class="arg"><span class="opt">?param1 value1 ...?</span></i>%&gt;</a></dt>
<dd><p>The <i class="arg">eentity operation</i> subcommands generate a &quot;C&quot; rvalue expression that
invokes the external operation named,
<i class="arg">operation</i> that has been defined for the <i class="arg">eentity</i> external entity.
The <i class="arg">paramN</i> are pased as arguments to the operation.
The type of the generated expresssion is the same as the
declared return type of <i class="arg">operation</i>.
Arguments must be given as <i class="arg">param</i> / <i class="arg">value</i> pairs.
All arguments to <i class="arg">operation</i> must be given but the order of the
parameter name / value pairs is arbitrary.</p>
<pre class="doctools_example">
unsigned colorId = &lt;%instance color instid%&gt; ;
unsigned shades = &lt;%ColorEE getColorShades color colorId%&gt; ;
</pre>
</dd>
</dl>
</div>
<div id="see-also" class="doctools_section"><h2><a name="see-also">See Also</a></h2>
<p>DSL, <a href="micca.html">micca</a></p>
</div>
<div id="keywords" class="doctools_section"><h2><a name="keywords">Keywords</a></h2>
<p><a href="../index.html#executable">executable</a>, <a href="../index.html#model">model</a></p>
</div>
<div id="copyright" class="doctools_section"><h2><a name="copyright">Copyright</a></h2>
<p>Copyright &copy; 2015 - 2019 by G. Andrew Mangogna</p>
</div>
</div></body></html>
