#!/usr/bin/env tclsh86

source ../src/oomoore.tcl

package require oomoore

# Specify state model
::oomoore statemodel create simpleModel {
    my State s1 {} {
        puts "simpleModel: [self]: [info level 0]"
        my variable foo
        set foo 100
    }
    my Transition s1 - e1 -> s1
    my Transition s1 - e2 -> s2

    my State s2 {a} {
        puts "simpleModel: [self]: [info level 0]"
        my variable foo
        puts "foo = $foo"
        puts "a = $a"
    }
    my Transition s2 - e2 -> s2
}

puts "methods = \"[info class methods simpleModel -all]\""

simpleModel create mymachine

mymachine receive e1
mymachine receive e2 42

::oo::class create mymod {
    superclass [oomoore statemodel new {
        my State s1 {} {
            puts "simpleModel: [self]: [info level 0]"
            my variable foo
            set foo 100
        }
        my Transition s1 - e1 -> s1
        my Transition s1 - e2 -> s2

        my State s2 {a} {
            puts "simpleModel: [self]: [info level 0]"
            my variable foo
            puts "foo = $foo"
            puts "a = $a"
            my bar 47
            my generate e3 -> [self]
        }
        my Transition s2 - e2 -> s2
        my Transition s2 - e3 -> s1
    }]

    constructor {} {
        next s2
        my variable foo
        set foo 200
    }

    method bar {b} {
        puts "overridden bar: $b"
    }
}

mymod create my2
my2 receive e2 42

oomoore generate e1 -> my2
oomoore qwait

oomoore delayed 1000 e2 -> my2
oomoore qwait 2000
